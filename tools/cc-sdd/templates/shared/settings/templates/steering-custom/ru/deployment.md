# Стандарты деплоймента

[Назначение: паттерны для CI/CD, окружений, релизов и отката]

## Философия
- Автоматизация всего; ручные шаги = источник ошибок
- Окружения идентичны насколько возможно
- Быстрый откат; маленькие инкременты

## Окружения

### Стандартные
- `development` — локальная разработка
- `staging` — pre-production тестирование
- `production` — live система

### Принципы
- Паритет окружений: одинаковые версии, конфигурации (кроме секретов)
- Изоляция данных: никогда production данные в staging/dev
- Feature flags для постепенного rollout

## CI/CD Pipeline

### Этапы
```
1. Build — компиляция, зависимости
2. Test — unit, integration, lint
3. Security — SAST, dependency scan
4. Deploy (staging) — автоматически
5. Deploy (production) — по approval или автоматически
```

### Правила
- Падение любого этапа = блокировка деплоя
- Все тесты зелёные перед merge
- Main branch = deployable всегда

## Деплоймент

### Стратегии
- **Rolling** — постепенная замена инстансов
- **Blue-Green** — переключение между окружениями
- **Canary** — малый % трафика на новую версию

Выбор: [наша стратегия] потому что [причина]

### Health Checks
```
/health — базовый статус
/health/ready — готовность принимать трафик
/health/live — процесс жив
```

## Откат

### Принципы
- Каждый деплой должен быть откатываемым
- Хранить N предыдущих версий
- Откат = один клик/команда

### Процедура
```bash
# Откат к предыдущей версии
deploy rollback --to=previous

# Откат к конкретной версии
deploy rollback --to=v1.2.3
```

## Мониторинг

### Обязательные метрики
- Latency (P50, P95, P99)
- Error rate
- Throughput (RPS)
- Resource usage (CPU, Memory)

### Алерты
- Критические: немедленное уведомление
- Warning: агрегация, периодическая проверка
- Info: логирование для анализа

## Секреты

### Правила
- Никогда в коде или логах
- Secret manager (Vault, AWS Secrets, etc.)
- Ротация по расписанию
- Аудит доступа

---
_Фокус на паттернах. CI/CD конфиги хранятся в репозитории._
