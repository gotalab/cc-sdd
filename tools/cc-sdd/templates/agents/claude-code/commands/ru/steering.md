---
description: Управление {{KIRO_DIR}}/steering/ как постоянной памятью проекта
allowed-tools: Bash, Read, Write, Edit, MultiEdit, Glob, Grep, LS
---

# Управление Kiro Steering

<background_information>
**Роль**: Поддерживать `{{KIRO_DIR}}/steering/` как постоянную память проекта.

**Миссия**:
- Bootstrap: Сгенерировать основной steering из кодовой базы (первый раз)
- Sync: Поддерживать синхронизацию steering и кодовой базы (обслуживание)
- Preserve: Пользовательские настройки священны, обновления аддитивны

**Критерии успеха**:
- Steering фиксирует паттерны и принципы, а не исчерпывающие списки
- Дрифт кода обнаружен и сообщён
- Все `{{KIRO_DIR}}/steering/*.md` обрабатываются одинаково (основные + кастомные)
</background_information>

<instructions>
## Определение сценария

Проверить статус `{{KIRO_DIR}}/steering/`:

**Режим Bootstrap**: Пустой ИЛИ отсутствуют основные файлы (product.md, tech.md, structure.md)  
**Режим Sync**: Все основные файлы существуют

---

## Процесс Bootstrap

1. Загрузить шаблоны из `{{KIRO_DIR}}/settings/templates/steering/ru/`
2. Анализировать кодовую базу (JIT):
   - `glob_file_search` для исходных файлов
   - `read_file` для README, package.json и т.д.
   - `grep` для паттернов
3. Извлечь паттерны (не списки):
   - Product: Цель, ценность, основные возможности
   - Tech: Фреймворки, решения, соглашения
   - Structure: Организация, именование, импорты
4. Сгенерировать файлы steering (следовать шаблонам)
5. Загрузить принципы из `{{KIRO_DIR}}/settings/rules/steering-principles.md`
6. Представить сводку для проверки

**Фокус**: Паттерны, направляющие решения, а не каталоги файлов/зависимостей.

---

## Процесс Sync

1. Загрузить все существующие steering (`{{KIRO_DIR}}/steering/*.md`)
2. Анализировать кодовую базу на изменения (JIT)
3. Обнаружить дрифт:
   - **Steering → Code**: Отсутствующие элементы → Предупреждение
   - **Code → Steering**: Новые паттерны → Кандидат на обновление
   - **Кастомные файлы**: Проверить релевантность
4. Предложить обновления (аддитивные, сохранить пользовательский контент)
5. Отчёт: Обновления, предупреждения, рекомендации

**Философия обновлений**: Добавлять, не заменять. Сохранять пользовательские секции.

---

## Принцип гранулярности

Из `{{KIRO_DIR}}/settings/rules/steering-principles.md`:

> "Если новый код следует существующим паттернам, steering не должен требовать обновления."

Документировать паттерны и принципы, а не исчерпывающие списки.

**Плохо**: Перечислить каждый файл в дереве каталогов  
**Хорошо**: Описать паттерн организации с примерами

</instructions>

## Руководство по инструментам

- `glob_file_search`: Найти исходные/конфигурационные файлы
- `read_file`: Прочитать steering, документы, конфигурации
- `grep`: Поиск паттернов
- `list_dir`: Анализировать структуру

**Стратегия JIT**: Получать когда нужно, не заранее.

## Описание вывода

Только сводка в чат (файлы обновляются напрямую).

### Bootstrap:
```
✅ Steering создан

## Сгенерировано:
- product.md: [Краткое описание]
- tech.md: [Ключевой стек]
- structure.md: [Организация]

Проверьте и утвердите как Источник Истины.
```

### Sync:
```
✅ Steering обновлён

## Изменения:
- tech.md: React 18 → 19
- structure.md: Добавлен API паттерн

## Дрифт кода:
- Компоненты не следуют соглашениям об импортах

## Рекомендации:
- Рассмотреть api-standards.md
```

## Примеры

### Bootstrap
**Вход**: Пустой steering, React TypeScript проект  
**Выход**: 3 файла с паттернами - "Feature-first", "TypeScript strict", "React 19"

### Sync
**Вход**: Существующий steering, новый каталог `/api`  
**Выход**: Обновлён structure.md, отмечены несоответствующие файлы, предложен api-standards.md

## Безопасность и Fallback

- **Безопасность**: Никогда не включать ключи, пароли, секреты (см. принципы)
- **Неопределённость**: Сообщить оба состояния, спросить пользователя
- **Сохранение**: При сомнениях добавить, а не заменить

## Примечания

- Все `{{KIRO_DIR}}/steering/*.md` загружаются как память проекта
- Шаблоны и принципы внешние для кастомизации
- Фокус на паттернах, не каталогах
- "Золотое правило": Новый код, следующий паттернам, не должен требовать обновлений steering
- Избегать документирования каталогов инструментов агентов (например, `.cursor/`, `.gemini/`, `.claude/`)
- Содержимое `{{KIRO_DIR}}/settings/` НЕ ДОЛЖНО документироваться в файлах steering (настройки - это метаданные, не знания проекта)
- Лёгкие ссылки на `{{KIRO_DIR}}/specs/` и `{{KIRO_DIR}}/steering/` допустимы; избегать других каталогов `.kiro/`
