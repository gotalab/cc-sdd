---
description: Сгенерировать задачи реализации для спецификации
allowed-tools: Read, Write, Edit, MultiEdit, Glob, Grep
argument-hint: <имя-функции> [-y] [--sequential]
---

# Генератор задач реализации

<background_information>
- **Миссия**: Сгенерировать детальные, действенные задачи реализации, которые переводят технический дизайн в исполняемые рабочие элементы
- **Критерии успеха**:
  - Все требования сопоставлены с конкретными задачами
  - Задачи правильно размерены (1-3 часа каждая)
  - Чёткая прогрессия задач с правильной иерархией
  - Описания на естественном языке, сфокусированные на возможностях
</background_information>

<instructions>
## Основная задача
Сгенерировать задачи реализации для функции **$1** на основе утверждённых требований и дизайна.

## Шаги выполнения

### Шаг 1: Загрузить контекст

**Прочитать весь необходимый контекст**:
- `{{KIRO_DIR}}/specs/$1/spec.json`, `requirements.md`, `design.md`
- `{{KIRO_DIR}}/specs/$1/tasks.md` (если существует, для режима слияния)
- **Весь каталог `{{KIRO_DIR}}/steering/`** для полной памяти проекта

**Проверить утверждения**:
- Если указан флаг `-y` ($2 == "-y"): Авто-утвердить требования и дизайн в spec.json
- Иначе: Проверить оба утверждены (остановить если нет, см. Безопасность и Fallback)
- Определить последовательный режим по наличию `--sequential`

### Шаг 2: Сгенерировать задачи реализации

**Загрузить правила генерации и шаблон**:
- Прочитать `{{KIRO_DIR}}/settings/rules/tasks-generation.md` для принципов
- Если `sequential` равен **false**: Прочитать `{{KIRO_DIR}}/settings/rules/tasks-parallel-analysis.md` для критериев параллельности
- Прочитать `{{KIRO_DIR}}/settings/templates/specs/ru/tasks.md` для формата (поддерживает маркеры `(P)`)

**Сгенерировать список задач, следуя всем правилам**:
- Использовать язык, указанный в spec.json
- Сопоставить все требования с задачами
- При документировании покрытия требований указывать только числовые ID (через запятую) без описательных суффиксов, скобок, переводов или свободных меток
- Убедиться, что все компоненты дизайна включены
- Проверить, что прогрессия задач логична и инкрементальна
- Свернуть структуры с единственной подзадачей, продвинув их до основных задач, избегать дублирования деталей на основных задачах-контейнерах (использовать паттерны шаблона соответственно)
- Применить маркеры `(P)` к задачам, удовлетворяющим критериям параллельности (опустить маркеры в последовательном режиме)
- Помечать опциональные подзадачи тестового покрытия `- [ ]*` только когда они строго покрывают критерии приёмки, уже удовлетворённые основной реализацией, и могут быть отложены после MVP
- Если найден существующий tasks.md, объединить с новым содержимым

### Шаг 3: Финализация

**Записать и обновить**:
- Создать/обновить `{{KIRO_DIR}}/specs/$1/tasks.md`
- Обновить метаданные spec.json:
  - Установить `phase: "tasks-generated"`
  - Установить `approvals.tasks.generated: true, approved: false`
  - Установить `approvals.requirements.approved: true`
  - Установить `approvals.design.approved: true`
  - Обновить метку времени `updated_at`

## Критические ограничения
- **Строго следовать правилам**: Все принципы в tasks-generation.md обязательны
- **Естественный язык**: Описывать что делать, а не детали структуры кода
- **Полное покрытие**: ВСЕ требования должны быть сопоставлены с задачами
- **Максимум 2 уровня**: Только основные задачи и подзадачи (без глубже вложенности)
- **Последовательная нумерация**: Основные задачи инкрементируются (1, 2, 3...), никогда не повторяются
- **Интеграция задач**: Каждая задача должна подключаться к системе (без осиротевшей работы)
</instructions>

## Руководство по инструментам
- **Сначала читать**: Загрузить весь контекст, правила и шаблоны перед генерацией
- **Писать в конце**: Генерировать tasks.md только после полного анализа и верификации

## Описание вывода

Предоставить краткую сводку на языке, указанном в spec.json:

1. **Статус**: Подтвердить генерацию задач в `{{KIRO_DIR}}/specs/$1/tasks.md`
2. **Сводка задач**: 
   - Всего: X основных задач, Y подзадач
   - Все Z требований покрыты
   - Средний размер задачи: 1-3 часа на подзадачу
3. **Валидация качества**:
   - ✅ Все требования сопоставлены с задачами
   - ✅ Зависимости задач проверены
   - ✅ Включены задачи тестирования
4. **Следующее действие**: Просмотреть задачи и продолжить когда готовы

**Формат**: Кратко (менее 200 слов)

## Безопасность и Fallback

### Сценарии ошибок

**Требования или дизайн не утверждены**:
- **Остановить выполнение**: Нельзя продолжать без утверждённых требований и дизайна
- **Сообщение пользователю**: "Требования и дизайн должны быть утверждены перед генерацией задач"
- **Предложенное действие**: "Запустите `/kiro:spec-tasks $1 -y` для авто-утверждения обоих и продолжения"

**Отсутствуют требования или дизайн**:
- **Остановить выполнение**: Оба документа должны существовать
- **Сообщение пользователю**: "Отсутствует requirements.md или design.md в `{{KIRO_DIR}}/specs/$1/`"
- **Предложенное действие**: "Сначала завершите фазы требований и дизайна"

**Неполное покрытие требований**:
- **Предупреждение**: "Не все требования сопоставлены с задачами. Проверьте покрытие."
- **Требуется действие пользователя**: Подтвердить намеренные пробелы или перегенерировать задачи

**Отсутствует шаблон/правила**:
- **Сообщение пользователю**: "Файлы шаблона или правил отсутствуют в `{{KIRO_DIR}}/settings/`"
- **Fallback**: Использовать встроенную базовую структуру с предупреждением
- **Предложенное действие**: "Проверьте настройку репозитория или восстановите файлы шаблонов"
- **Отсутствуют числовые ID требований**:
  - **Остановить выполнение**: Все требования в requirements.md ДОЛЖНЫ иметь числовые ID. Если у любого требования отсутствует числовой ID, остановить и запросить исправление requirements.md перед генерацией задач

### Следующая фаза: Реализация

**Перед началом реализации**:
- **ВАЖНО**: Очистить историю диалога и освободить контекст перед запуском `/kiro:spec-impl`
- Это применяется при начале первой задачи ИЛИ переключении между задачами
- Свежий контекст обеспечивает чистое состояние и правильный фокус задачи

**Если задачи утверждены**:
- Выполнить конкретную задачу: `/kiro:spec-impl $1 1.1` (рекомендуется: очистить контекст между задачами)
- Выполнить несколько задач: `/kiro:spec-impl $1 1.1,1.2` (использовать осторожно, очищать контекст между задачами)
- Без аргументов: `/kiro:spec-impl $1` (выполняет все ожидающие задачи - НЕ рекомендуется из-за раздувания контекста)

**Если нужны изменения**:
- Предоставить обратную связь и повторно запустить `/kiro:spec-tasks $1`
- Существующие задачи используются как референс (режим слияния)

**Примечание**: Фаза реализации проведёт вас через выполнение задач с соответствующим контекстом и валидацией.

think
