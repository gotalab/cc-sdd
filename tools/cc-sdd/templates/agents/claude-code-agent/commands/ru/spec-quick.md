---
description: Быстрая генерация спецификации в интерактивном или автоматическом режиме
allowed-tools: Read, SlashCommand, TodoWrite, Bash, Write, Glob
argument-hint: <описание-проекта> [--auto]
---

# Быстрый генератор спецификаций

<background_information>
- **Миссия**: Выполнить все фазы спецификации (init → requirements → design → tasks) одной командой
- **Критерии успеха**:
  - Интерактивный режим: Пользователь контролирует прогресс с запросами согласования на каждой фазе
  - Автоматический режим: Все фазы выполняются без прерывания при наличии флага `--auto`
  - Все сгенерированные спецификации сохраняют качество сопоставимое с ручным рабочим процессом
</background_information>

<instructions>
## ⚠️ КРИТИЧНО: Правила выполнения в автоматическом режиме

**Если `--auto` флаг присутствует в `$ARGUMENTS`, вы в АВТОМАТИЧЕСКОМ РЕЖИМЕ.**

В Автоматическом режиме:
- Выполнять ВСЕ 4 фазы в непрерывном цикле без остановки
- Использовать TodoWrite для отслеживания прогресса (4 задачи: init, requirements, design, tasks)
- Завершение каждой фазы обновляет TodoWrite и немедленно продолжает
- ИГНОРИРОВАТЬ любые сообщения "Следующий шаг" от Фаз 2-4 (они для автономного использования)
- Останавливаться ТОЛЬКО после завершения Фазы 4 или при ошибке

**Отслеживание прогресса с TodoWrite**:
- Фаза 1 завершена = 1/4 задач → Продолжить к Фазе 2
- Фаза 2 завершена = 2/4 задач → Продолжить к Фазе 3
- Фаза 3 завершена = 3/4 задач → Продолжить к Фазе 4
- Фаза 4 завершена = 4/4 задач → Вывести сводку и выйти

---

## Основная задача
Выполнить 4 фазы спецификации последовательно. В автоматическом режиме выполнять все фазы без остановки. В интерактивном режиме запрашивать согласование между фазами.

## Шаги выполнения

### Шаг 1: Разбор аргументов и инициализация

Разобрать `$ARGUMENTS`:
- Если содержит `--auto`: **Автоматический режим** (выполнить все 4 фазы)
- Иначе: **Интерактивный режим** (запрос на каждой фазе)
- Извлечь описание (удалить флаг `--auto` если присутствует)

**Создать список задач TodoWrite**:
```json
[
  {"content": "Инициализировать спецификацию", "activeForm": "Инициализация спецификации", "status": "pending"},
  {"content": "Сгенерировать требования", "activeForm": "Генерация требований", "status": "pending"},
  {"content": "Сгенерировать дизайн", "activeForm": "Генерация дизайна", "status": "pending"},
  {"content": "Сгенерировать задачи", "activeForm": "Генерация задач", "status": "pending"}
]
```

### Шаг 2: Выполнение цикла фаз

#### Фаза 1: Инициализация спецификации (Прямая реализация)

**Обновить TodoWrite**: Отметить задачу 1 как `in_progress`.

**Основная логика**:
1. **Сгенерировать имя функции**: Преобразовать описание в kebab-case
2. **Проверить уникальность**: Использовать Glob для проверки `{{KIRO_DIR}}/specs/*/`
3. **Создать директорию**: Использовать Bash: `mkdir -p {{KIRO_DIR}}/specs/{feature-name}`
4. **Инициализировать файлы из шаблонов** из `{{KIRO_DIR}}/settings/templates/specs/ru/`

**Автоматический режим**: НЕМЕДЛЕННО продолжить к Фазе 2.
**Интерактивный режим**: Запрос "Продолжить генерацию требований? (да/нет)"

#### Фаза 2: Генерация требований

**Выполнить SlashCommand**:
```
/kiro:spec-requirements {feature-name}
```

**ВАЖНО**: В Автоматическом режиме ИГНОРИРОВАТЬ сообщение "Следующий шаг".

**Обновить TodoWrite**: Отметить задачу 2 как `completed`, задачу 3 как `in_progress`.

#### Фаза 3: Генерация дизайна

**Выполнить SlashCommand**:
```
/kiro:spec-design {feature-name} -y
```

Примечание: Флаг `-y` авто-согласует требования.

#### Фаза 4: Генерация задач

**Выполнить SlashCommand**:
```
/kiro:spec-tasks {feature-name} -y
```

**Все 4 задачи завершены. Цикл ЗАВЕРШЁН.**

</instructions>

## Описание вывода

### Финальная сводка завершения

```
✅ Быстрая генерация спецификации завершена!

## Сгенерированные файлы:
- {{KIRO_DIR}}/specs/{feature}/spec.json
- {{KIRO_DIR}}/specs/{feature}/requirements.md ({X} требований)
- {{KIRO_DIR}}/specs/{feature}/design.md ({Y} компонентов)
- {{KIRO_DIR}}/specs/{feature}/tasks.md ({N} задач)

⚠️ Быстрая генерация пропустила:
- `/kiro:validate-gap` - Анализ пробелов (проверка интеграции)
- `/kiro:validate-design` - Ревью дизайна (валидация архитектуры)

## Следующие шаги:
1. Проверить сгенерированные спецификации (особенно design.md)
2. Опциональная валидация:
   - `/kiro:validate-gap {feature}` - Проверить интеграцию с существующей кодовой базой
   - `/kiro:validate-design {feature}` - Проверить качество архитектуры
3. Начать реализацию: `/kiro:spec-impl {feature}`
```

## Безопасность и обработка ошибок

### Рекомендации по использованию

**Используйте Автоматический режим** (`--auto`) когда:
- Простая функция (CRUD, базовый UI)
- Прототипирование / proof-of-concept
- Хорошо известный паттерн функции

**Используйте Интерактивный режим** (по умолчанию) когда:
- Первое использование spec-quick
- Хотите проверять каждую фазу
- Умеренно сложная функция

**Используйте Стандартный рабочий процесс** (НЕ spec-quick) когда:
- Сложная интеграция с существующими системами
- Критичные для безопасности функции
- Требуется production-ready качество
- Нужен анализ пробелов или валидация дизайна
