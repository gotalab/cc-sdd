---
description: Анализ разрыва реализации между требованиями и существующей кодовой базой
allowed-tools: Bash, Glob, Grep, Read, Write, Edit, MultiEdit, WebSearch, WebFetch
argument-hint: <имя-функции>
---

# Валидация разрыва реализации

<background_information>
- **Миссия**: Анализировать разрыв между требованиями и существующей кодовой базой для информирования стратегии реализации
- **Критерии успеха**:
  - Полное понимание паттернов и компонентов существующей кодовой базы
  - Чёткое определение отсутствующих возможностей и проблем интеграции
  - Оценено несколько жизнеспособных подходов к реализации
  - Определены потребности в техническом исследовании для фазы дизайна
</background_information>

<instructions>
## Основная задача
Анализировать разрыв реализации для функции **$1** на основе утверждённых требований и существующей кодовой базы.

## Шаги выполнения

1. **Загрузить контекст**:
   - Прочитать `{{KIRO_DIR}}/specs/$1/spec.json` для языка и метаданных
   - Прочитать `{{KIRO_DIR}}/specs/$1/requirements.md` для требований
   - **Загрузить ВЕСЬ контекст steering**: Прочитать весь каталог `{{KIRO_DIR}}/steering/` включая:
     - Стандартные файлы: `structure.md`, `tech.md`, `product.md`
     - Все кастомные файлы steering (независимо от настроек режима)
     - Это обеспечивает полную память и контекст проекта

2. **Прочитать руководства по анализу**:
   - Прочитать `{{KIRO_DIR}}/settings/rules/gap-analysis.md` для комплексной методологии анализа

3. **Выполнить Gap-анализ**:
   - Следовать методологии gap-analysis.md для тщательного исследования
   - Анализировать существующую кодовую базу с помощью Grep и Read
   - Использовать WebSearch/WebFetch для исследования внешних зависимостей при необходимости
   - Оценить несколько подходов к реализации (расширить/новый/гибрид)
   - Использовать язык, указанный в spec.json, для вывода

4. **Сгенерировать документ анализа**:
   - Создать полный gap-анализ, следуя руководствам по выводу в gap-analysis.md
   - Представить несколько жизнеспособных вариантов с компромиссами
   - Отметить области, требующие дальнейшего исследования

## Важные ограничения
- **Информация вместо решений**: Предоставить анализ и варианты, не финальные решения по реализации
- **Несколько вариантов**: Представить жизнеспособные альтернативы где применимо
- **Тщательное исследование**: Использовать инструменты для глубокого понимания существующей кодовой базы
- **Явные пробелы**: Чётко отметить области, требующие исследования или изучения
</instructions>

## Руководство по инструментам
- **Сначала читать**: Загрузить весь контекст (спецификация, steering, правила) перед анализом
- **Активно использовать Grep**: Искать в кодовой базе паттерны, соглашения и точки интеграции
- **WebSearch/WebFetch**: Исследовать внешние зависимости и лучшие практики при необходимости
- **Писать в конце**: Генерировать анализ только после полного исследования

## Описание вывода
Предоставить вывод на языке, указанном в spec.json:

1. **Сводка анализа**: Краткий обзор (3-5 пунктов) объёма, проблем и рекомендаций
2. **Статус документа**: Подтвердить использованный подход к анализу
3. **Следующие шаги**: Направить пользователя к фазе дизайна

**Требования к формату**:
- Использовать заголовки Markdown для ясности
- Сводка должна быть краткой (менее 300 слов)
- Детальный анализ следует руководствам по выводу gap-analysis.md

## Безопасность и Fallback

### Сценарии ошибок
- **Отсутствуют требования**: Если requirements.md не существует, остановить с сообщением: "Сначала запустите `/kiro:spec-requirements $1` для генерации требований"
- **Требования не утверждены**: Если требования не утверждены, предупредить пользователя но продолжить (gap-анализ может информировать ревизии требований)
- **Каталог Steering пустой**: Предупредить пользователя, что контекст проекта отсутствует и может повлиять на качество анализа
- **Неясная сложная интеграция**: Отметить для комплексного исследования в фазе дизайна, а не блокировать
- **Язык не определён**: По умолчанию английский (`en`), если spec.json не указывает язык

### Следующая фаза: Генерация дизайна

**Если Gap-анализ завершён**:
- Просмотреть инсайты gap-анализа
- Запустить `/kiro:spec-design $1` для создания документа технического дизайна
- Или `/kiro:spec-design $1 -y` для авто-утверждения требований и прямого продолжения

**Примечание**: Gap-анализ опционален, но рекомендуется для brownfield-проектов для информирования решений по дизайну.
